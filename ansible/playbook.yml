---
- name: Install Docker
  hosts: environment
  become: true
  
  tasks:
  - name: Add docker repo
    template:
      src: /vagrant/ansible/docker.repo
      dest: /etc/yum.repos.d/docker.repo

  - name: Install docker
    yum:
      name: docker-engine
      state: present
      
  - name: Start docker
    service:
      name: docker
      state: started

  - name: Enable docker
    systemd:
      name: docker
      enabled: yes
      
  - name: Admin access for docker user
      shell: sudo usermod -aG docker $(whoami)
      args:
        executable: /bin/bash
        
  - name:  Add Insecure Registry to Docker Engine
    lineinfile:
      dest: /etc/docker/daemon.json
      state: present
      regexp: '^{}'
      line: '{ "insecure-registries" : ["192.168.100.10:5000"]  }'

  - name: install packages
    yum: name={{ item }} state=present
    with_items:
      - epel-release
      - python2-pip
  
  - name: install docker-py
    pip:
      name: docker-py
